<html>

<head>
<title>IGMP: Протокол управления группами Internet (Internet
Group Management Protocol)</title>

<meta http-equiv="Content-type" content="text/html; charset=koi8-r">
<link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>




<p><a NAME="t130000"></a>Глава 13 IGMP: протокол управления
группами Internet</p>
<u>

<p><b><a NAME="t131000"></a>Введение</p>
</b></u>

<p><small>В разделе <a HREF="tcp12.html#t124000">&quot;Рассылка
групповых сообщений&quot;</a> главы 12 приводится
общее описание групповой адресации IP и
описывается, как IP адреса класса D преобразуются
в Ethernet адреса. Мы кратко упомянули, как
осуществляется групповая рассылка в сети,
состоящей из одного физического кабеля, однако
отложили на потом рассмотрение вопроса, что
происходит при групповой адресации в нескольких
сетях и каким образом групповые датаграммы
проходят через маршрутизаторы. </small></p>

<p><small>В этой главе мы рассмотрим протокол
управления группами Internet (IGMP - Internet Group Management
Protocol), который используется хостами и
маршрутизаторами, для того чтобы поддерживать
групповую рассылку сообщений. Он позволяет всем
системам физической сети знать, какие хосты в
настоящее время объединены в группы и к каким
группам они принадлежат. Эта информация
необходима для групповых маршрутизаторов,
именно так они узнают, какие групповые
датаграммы необходимо перенаправлять и на какие
интерфейсы. IGMP определен в RFC 1112 [Deering 1989]. </small></p>

<p><small>Как и <a NAME="t131001"></a>ICMP, IGMP является частью IP
уровня. Так же как ICMP, IGMP сообщения передаются в IP
датаграммах. В отличие от других протоколов,
которые мы уже рассмотрели, IGMP имеет сообщение
фиксированного размера, без необязательных
данных. На рисунке 13.1 показана инкапсуляция IGMP
сообщения в IP датаграмму.<a NAME="t131002"></a></small></p>


<p ALIGN="CENTER"><small><img SRC="t13_1_20.jpg" WIDTH="169" HEIGHT="75"></small></p>


<p ALIGN="CENTER"><small>Рисунок 13.1 Инкапсуляция IGMP
сообщения в IP датаграмму.</small></p>

<p>&nbsp;</p>

<p><small>На то, что в IP датаграмме находится IGMP
сообщение, указывает величина в поле протокола
равная 2. </small></p>
<u><b>

<p><a NAME="t132000"></a>IGMP сообщение</p>
</b></u>

<p><small>На рисунке 13.2 показан формат 8-байтового IGMP
сообщения.<a NAME="t132001"></a></small></p>


<p ALIGN="CENTER"><small><img SRC="t13_2_20.jpg" WIDTH="509" HEIGHT="90"></small></p>


<p ALIGN="CENTER"><small>Рисунок 13.2 Формат полей IGMP
сообщения.</small></p>

<p>&nbsp;</p>

<p><small>Поле версии IGMP (IGMP version) установлено в 1. Поле
тип IGMP (IGMP type) устанавливается в 1 для запроса,
посылаемого групповым маршрутизатором, и в 2 для
ответа, отправляемого хостом. <a NAME="t132002"></a>Контрольная
сумма (checksum) рассчитывается так же, как
контрольная сумма ICMP.</small></p>

<p><small>Групповой адрес (group address) это <a NAME="t132003"></a>IP
адрес класса D.. В запросе поле группового адреса
устанавливается в 0. В отчете оно содержит
групповой адрес. Мы расскажем более подробно об
этом в следующих разделах, когда будем говорить о
том, как функционирует IGMP.</small></p>


<p><b><u>Протокол IGMP</u></p>
<i>

<p>Вступление в группу</p>
</i></b>

<p><small>Фундаментальной концепцией для работы
группы является то, что процесс вступает в группу
с определенным интерфейсом хоста. (Мы используем
термин <a NAME="t133001"></a>процесс, который обозначает
программу, которая запущена операционной
системой.) Членство в группе динамическое - со
временем процесс может как вступать, так и
выходить из группы.</small></p>

<p><small>Естественно, процесс должен иметь
возможность вступить в группу с указанным
интерфейсом. Процесс также может покинуть
группу, в которую он до этого вступил. Для
вступления в группу и выхода из группы требуется,
чтобы какой-либо <a NAME="t133002"></a>API на хосте
поддерживал групповую рассылку. Мы используем
выражение &quot;интерфейс&quot;, потому что членство в
группе связано с интерфейсом. Процесс может
вступить в одну и ту же группу с разных
интерфейсов.</small></p>

<p>&nbsp;</p>


<p>Релиз IP, поддерживающий
групповую рассылку в Berkeley Unix Стэндфордского
университета, детализирует эти изменения
сокетов API. Эти изменения также присутствуют в <a NAME="t133003"></a>Solaris 2.x и описаны в страницах помощи ip(7).</p>


<p>&nbsp;</p>

<p><small>Поэтому идентификатор хоста в группе это
адрес группы и интерфейс. Хост должен помнить
таблицу всех групп, к которым принадлежит хотя бы
один процесс, и счетчик обращений, то есть
количество процессов, принадлежащих к группе.</small></p>
<i><b>

<p><a NAME="t133004"></a>IGMP запросы и отчеты</p>
</b></i>

<p><small>IGMP сообщения используются групповыми
маршрутизаторами, чтобы поддерживать членство в
группах для каждой сети, физически подключенной
к маршрутизатору. Существуют следующие правила.</small>

<ol>
  <li><small>Хост отправляет первый IGMP отчет, когда
    первый процесс вступает в группу. Если несколько
    процессов на данном хосте вступили в одну и ту же
    группу, отправляется только один отчет, в тот
    момент, когда процесс первый раз вступил в
    группу. Отчет посылается на тот же интерфейс, с
    которым процесс вступил в группу.</small></li>
  <li><small>Хост не посылает отчет, когда процесс
    выходит из группы, даже когда последний процесс
    вышел из группы. Хост знает, что в этой группе
    больше нет членов, поэтому когда он получает
    следующий запрос (следующий шаг), он не
    отправляет отчет.</small></li>
  <li><small>Групповой маршрутизатор отправляет IGMP
    запрос с регулярными интервалами, чтобы
    выяснить, принадлежат ли процессы каких-либо
    хостов к каким-либо группам. Маршрутизатор
    послает один запрос на каждый интерфейс.
    Групповой адрес в запросе установлен в 0, так как
    маршрутизатор ожидает приход одного отклика от
    хоста для каждой группы, к которой от хоста
    принадлежит один или несколько членов.</small></li>
  <li><small>Хост отвечает на IGMP запрос посылкой одного
    IGMP отчета для каждой группы, которая содержит
    хотя бы один процесс.</small></li>
</ol>

<p><small>С использованием этих запросов и отчетов
групповой маршрутизатор поддерживает таблицу,
содержащую информацию о том, на котором из его
интерфейсов имеется один или несколько хостов в
группе. Когда маршрутизатор получает групповую
датаграмму, которую необходимо перенаправить, он
перенаправляет ее (с использованием
соответствующего группового адреса канального
уровня) только на тот интерфейс, на котором до сих
пор есть хосты, процессы которох принадлежат к
этой группе. </small></p>

<p><small>На рисунке 13.3 показаны два типа IGMP
сообщений, отчеты, отправленные хостом, и
запросы, отправленные маршрутизатором.
Маршрутизатор опрашивает каждый хост, чтобы тот
идентифицировал каждую группу для данного
интерфейса.<a NAME="t133005"></a></small></p>


<p ALIGN="CENTER"><small><img SRC="t13_3_20.jpg" WIDTH="525" HEIGHT="133"></small></p>


<p ALIGN="CENTER"><small>Рисунок 13.3 IGMP отчеты и запросы.</small></p>

<p>&nbsp;</p>

<p><small>Мы поговорим о поле TTL позже в этом разделе.</small></p>
<i><b>

<p>Детали реализации</p>
</b></i>

<p><small>В протоколе существуют некоторые аспекты,
которые улучшают его производительность.
Во-первых, когда хост посылает исходный IGMP отчет
(когда первый процесс вступил в группу), не
существует гарантии, что этот отчет будет
доставлен (так как используется средство
доставки IP). Позже отправляется еще один отчет.
Время, когда будет отправлен следующий отчет,
выбирается хостом случайным образом, причем
значение времени находится в диапазоне от 0 до 10
секунд. </small></p>

<p><small>Когда хост получает запрос от
маршрутизатора, он не отвечает сразу же, а
откладывает ответы на более позднее время. (Мы
используем множественное число &quot;ответы&quot;,
потому что хост должен послать один отчет для
каждой группы, которая содержит одного или
несколько членов.) Так как несколько хостов могут
отправить отчет для одной и той же группы, каждый
отправляет свой отчет с задержкой, выбранной
случайным образом. Также обратите внимание на то,
что все хосты подключенные к одной физической
сети получают все отчеты от других хостов,
находящихся в той же группе, потому что адрес
назначения отчета (см. рисунок 13.3) - это групповой
адрес. А это, в свою очередь, означает, что если
хост отложил момент отправки отчета, однако
получил копию того же самого отчета от другого
хоста, ответ может быть отменен. Это объясняется
тем, что групповому маршрутизатору нет
необходимости знать, сколько хостов принадлежит
к группе - ему достаточно знать, что по крайней
мере один хост принадлежит к группе. </small></p>

<p><small>На одном физическом кабеле без групповых
маршрутизаторов, траффик, принадлежащий IGMP, - это
отчеты, которые отправляются хостами,
поддерживающими групповую адресацию IP, когда они
вступают в новую группу.</small></p>
<i><b>

<p>Поле времени жизни</p>
</b></i>

<p><small>На рисунке 13.3 мы видели, что поле <a NAME="t133006"></a>TTL
в отчете и запросе установлено в 1. Это напоминает
обычное TTL поле в IP заголовке. Групповая
датаграмма с TTL исходно равным 0 не &quot;уйдет&quot;
дальше своего хоста. По умолчанию групповые
датаграммы рассылаются с TTL равным 1. Это
позволяет датаграммам распространяться только в
своей подсети. Значение TTL больше единицы может
быть установлено групповым маршрутизатором. </small></p>

<p><small>Обратитесь к разделу <a HREF="tcp06.html#t062000">&quot;Типы
сообщений ICMP&quot;</a> главы 6, где говорится, что ICMP
ошибка никогда не генерируется в ответ на
датаграмму, направляемую на групповой адрес.
Групповые маршрутизаторы не генерируют ICMP
ошибку <a NAME="t133007"></a>&quot;время истекло&quot; (time exceeded),
когда значение TTL становится равным 0.</small></p>

<p>&nbsp;</p>


<p>Обычно,
пользовательский процесс не заботится о
значении исходящего TTL. Одно исключение, пожалуй,
программа Traceroute (см. <a HREF="tcp08.html">главу 8</a>),
принцип работы которой основан как раз на
изменении значения поля TTL. Однако, приложения,
которые работают с групповой адресацией, должны
иметь возможность установить исходящее поле TTL.
Это означает, что программный интерфейс должен
предоставлять эту возможность пользовательским
процессам.</p>


<p>&nbsp;</p>

<p><small>Путем увеличения TTL приложение может
осуществить <a NAME="t133008"></a>расширенный поиск (expanding
ring search) конкретного сервера. В этом случае первая
групповая датаграмма посылается с TTL равным 1,
если ответ не получен, посылается датаграмма с TTL
равным 2, затем 3 и так далее. В этом случае
приложение определяет положение ближайшего
сервера в количествах пересылок. </small></p>

<p><small>Специальный диапазон адресов 224.0.0.0 - 224.0.0.255
отводится для приложений, которые не будут
рассылать групповые запросы дальше чем на одну
пересылку. Групповые маршрутизаторы не должны
перенаправлять датаграммы с такими адресами
назначения, вне зависимости от TTL.</small></p>
<i><b>

<p>Группа всех хостов (All-Hosts)</p>
</b></i>

<p><small>На рисунке 13.3 мы видели, что IGMP запрос от
маршрутизатора отправляется на IP адрес
назначения 224.0.0.1. Этот адрес называется адресом
группы <a NAME="t133009"></a>всех хостов (all-hosts). Он имеет
отношение ко всем хостам и маршрутизаторам
подключенным к физической сети и поддерживающим
групповую адресацию. Каждый хост автоматически
вступает в эту группу со всеми интерфейсами,
которые поддерживают групповую адресацию, при
инициализации интерфейса. О членстве в этой
группе никогда не сообщается (рассылкой отчетов).</small></p>
<u><b>

<p><a NAME="t134000"></a>Пример</p>
</b></u>

<p><small>Сейчас, когда мы рассмотрели некоторые
особенности групповой адресации IP, давайте
посмотрим на то, как рассылаются сообщения. Мы
добавили поддержку групповой адресации IP на
хосте sun, а также воспользовались некоторыми
тестовыми программами, которые присутствуют в
программном обеспечении, работающем с групповой
адресацией.</small></p>

<p><small>Во-первых, мы используем модифицированную
версию команды <a NAME="t134001"></a>netstat, которая сообщает
о членстве в группах для каждого интерфейса.
(Стандартный вывод netstat -ni для этого хоста
приводится в разделе <a HREF="tcp03.html#t039000">&quot;Команда
netstat&quot;</a> главы 3.) Ниже мы выделили строки,
имеющие отношение к группам, жирным шрифтом:</small></p>

<p>&nbsp;</p>


<p><br>
sun % <b>netstat -nia</b><br>
Name&nbsp; Mtu&nbsp;&nbsp; Network&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Ipkts
Ierrs&nbsp;&nbsp;&nbsp; Opkts Oerrs Coll<br>
le0&nbsp;&nbsp; 1500&nbsp; 140.252.13.&nbsp; 140.252.13.33
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4370&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0
&nbsp;&nbsp;&nbsp;&nbsp; 4924&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>224.0.0.1</b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 08:00:20:03:f6:42<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>01:00:5e:00:00:01</b><br>
sl0&nbsp;&nbsp; 552&nbsp;&nbsp; 140.252.1&nbsp;&nbsp;&nbsp; 140.252.1.29
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 13587&nbsp;&nbsp;&nbsp;&nbsp; 0
&nbsp;&nbsp;&nbsp; 15615&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>224.0.0.1</b><br>
lo0&nbsp;&nbsp; 1536&nbsp; 127
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 127.0.0.1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1351
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 1351&nbsp;&nbsp;&nbsp;&nbsp; 0
&nbsp;&nbsp;&nbsp; 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>224.0.0.1</b><br>
</p>


<p>&nbsp;</p>

<p><small>Так как указана опция <a NAME="t134002"></a>-n, IP
адреса печатает в цифровом формате (а не в виде
имен), <a NAME="t134003"></a>-i печатает статистику по
интерфейсам, и <a NAME="t134004"></a>-a предоставляет отчет
о всех сконфигурированных интерфейсах. </small></p>

<p><small>Вторая строка в выводе для le0 (Ethernet) сообщает
о том, что этот интерфейс принадлежит к группе
224.0.0.1 (группа &quot;все хосты&quot;), а через одну
строку показан соответствующий Ethernet адрес:
01:00:5e:00:00:01. Это как раз то, что мы и ожидали для
Ethernet адреса. Подобное соответствие описано в
разделе <a HREF="tcp12.html#t124000">&quot;Рассылка групповых
сообщений&quot;</a> главы 12. Мы видим, что два других
интерфейса, которые поддерживают рассылку
групповых сообщений, канал SLIP - sl0 и <a NAME="t134005"></a>loopback
интерфейс lo0, также принадлежат к группе всех
хостов.</small></p>

<p><small>Для маршрутизации групповых датаграмм
используется обычная таблица маршрутизации.
Пункты, помеченные жирным шрифтом, показывают
все датаграммы для 224.0.0.0, отправлены в Ethernet:</small></p>

<p>&nbsp;</p>


<p><br>
sun % <b>netstat -rn</b><br>
Routing tables<br>
Destination&nbsp;&nbsp;&nbsp;&nbsp; Gateway
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Flags&nbsp;&nbsp; Refcnt Use
&nbsp;&nbsp;&nbsp;&nbsp; Interface<br>
140.252.13.65&nbsp;&nbsp; 140.252.13.35&nbsp;&nbsp;&nbsp;&nbsp; UGH
&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; le0<br>
127.0.0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 127.0.0.1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 381&nbsp;&nbsp;&nbsp;&nbsp; lo0<br>
140.252.1.183&nbsp;&nbsp; 140.252.1.29&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UH
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sl0<br>
default&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 140.252.1.183
&nbsp;&nbsp;&nbsp;&nbsp; UG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 328&nbsp;&nbsp;&nbsp;&nbsp; sl0<br>
<b>224.0.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 140.252.13.33&nbsp;&nbsp;&nbsp;&nbsp; U
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 66
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; le0</b><br>
140.252.13.32&nbsp;&nbsp; 140.252.13.33&nbsp;&nbsp;&nbsp;&nbsp; U
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5581
&nbsp;&nbsp;&nbsp; le0<br>
</p>


<p>&nbsp;</p>

<p><small>Если Вы сравните эту таблицу маршрутизации
с той, которую мы показали в разделе <a HREF="tcp09.html#t092000">&quot;Принципы маршрутизации&quot;</a>
главы 9 для маршрутизатора sun, то увидите, что
единственным отличием является запись для
группы. </small></p>

<p><small>А сейчас запустим тестовую программу,
которая позволит вступить в группу для
определенного интерфейса. (Вывод этой тестовой
программы не приводится.) Мы вступили в группу
224.1.2.3 с интерфейсом Ethernet (140.252.13.33). Исполнение netstat
показывает, что ядро вступило в группу Ethernet
адресом, как мы и ожидали. Отличия от предыдущего
вывода команды netstat приведены жирным шрифтом:</small></p>

<p>&nbsp;</p>


<p><br>
sun % <b>netstat -nia</b><br>
Name&nbsp; Mtu&nbsp;&nbsp; Network&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Address
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Ipkts Ierrs
&nbsp;&nbsp;&nbsp; Opkts Oerrs&nbsp; Coll<br>
le0&nbsp;&nbsp; 1500&nbsp; 140.252.13.&nbsp; 140.252.13.33
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4374&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0
&nbsp;&nbsp;&nbsp;&nbsp; 4929&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>224.1.2.3</b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 224.0.0.1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 08:00:20:03:f6:42<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>01:00:5e:01:02:03</b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01:00:5e:00:00:01<br>
sl0&nbsp;&nbsp; 552&nbsp;&nbsp; 140.252.1&nbsp;&nbsp;&nbsp; 140.252.1.29
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 13862&nbsp;&nbsp;&nbsp;&nbsp; 0
&nbsp;&nbsp;&nbsp; 15943&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 224.0.0.1<br>
lo0&nbsp;&nbsp; 1536&nbsp; 127
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 127.0.0.1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1360
&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 1360&nbsp;&nbsp;&nbsp;&nbsp; 0
&nbsp;&nbsp;&nbsp;&nbsp; 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 224.0.0.1<br>
</p>


<p>&nbsp;</p>

<p><small>Здесь снова показан вывод для двух других
интерфейсов, sl0 и lo0, из чего видно, что в группу
вступил только один интерфейс.</small></p>

<p><small>На рисунке 13.4 показан вывод команды <a NAME="t134006"></a>tcpdump, соответствующий процессу
вступления в группу.<a NAME="t134007"></a></small></p>

<p>&nbsp;</p>


<p><br>
1&nbsp; 0.0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8:0:20:3:f6:42
1:0:5e:1:2:3 ip 60:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun
&gt; 224.1.2.3: igmp report 224.1.2.3 [ttl 1]<br>
<br>
2&nbsp; 6.94 (6.94)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8:0:20:3:f6:42
1:0:5e:1:2:3 ip 60:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun
&gt; 224.1.2.3: igmp report 224.1.2.3 [ttl 1]<br>
</p>


<p>&nbsp;</p>

<p><small>Рисунок 13.4 Вывод команды tcpdump при
вступлении хоста в группу.</small></p>

<p>&nbsp;</p>

<p><small>Строка 1 соответствует моменту, когда хост
вступает в группу. Следующая строка - это
задержанный отчет, который, как мы говорили,
отправляется с некоторой случайной задержкой (до
10 секунд). </small></p>

<p><small>В этих двух строках показаны аппаратные
адреса, чтобы убедиться в том, что адрес
назначения Ethernet это корректный групповой адрес.
Также стоит убедиться в том, что IP адрес
источника это один из соответствующих адресов sun,
а IP адрес назначения это групповой адрес. Адрес,
сообщенный в отчете, - это тот же групповой адрес. </small></p>

<p><small>И в заключение, необходимо отметить, что
значение <a NAME="t134008"></a>TTL установлено в 1, как было
указано ранее. Команда tcpdump печатает TTL в
квадратных скобках, когда его значение равно 0
или 1. Это потому, что TTL обычно больше, чем эти
значения. В случае групповой адресации мы
ожидаем увидеть множество IP датаграмм с TTL равным
1. </small></p>

<p><small>Из этого вывода видно, что групповой
маршрутизатор должен воспринимать все групповые
датаграммы на всех своих интерфейсах.
Маршрутизатор не имеет представления, в какую
группу должен вступить хост.</small></p>
<i><b>

<p>Пример работы группового маршрутизатора</p>
</b></i>

<p><small>Давайте продолжим предыдущий пример,
однако сейчас запустим демон групповой
маршрутизации на хосте sun. В данном случае нас
интересуют не детали реализации протоколов
групповой маршрутизации, а то, как происходит
обмен IGMP запросами и отчетами. Даже несмотря на
то, что демон групповой маршрутизации запущен
только на одном хосте, и только этот
(единственный) хост поддерживает групповую
адресацию (sun), групповые запросы и отчеты
перемещаются по Ethernet. </small></p>

<p><small>Перед стартом демона маршрутизации мы
вступили в другую группу: 224.9.9.9. На рисунке 13.5
показан вывод.<a NAME="t134009"></a></small></p>

<p>&nbsp;</p>


<p><br>
1 0.0 sun &gt; 224.0.0.4: igmp report 224.0.0.4<br>
<br>
2&nbsp;&nbsp;&nbsp; 0.00 (&nbsp; 0.00)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun &gt; 224.0.0.1: igmp
query<br>
3&nbsp;&nbsp;&nbsp; 5.10 (&nbsp; 5.10)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun &gt; 224.9.9.9: igmp
report 224.9.9.9<br>
<br>
4&nbsp;&nbsp;&nbsp; 5.22 (&nbsp; 0.12)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun &gt; 224.0.0.1: igmp
query<br>
5&nbsp;&nbsp;&nbsp; 7.90 (&nbsp; 2.68)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun &gt; 224.1.2.3: igmp
report 224.1.2.3<br>
6&nbsp;&nbsp;&nbsp; 8.50 (&nbsp; 0.60)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun &gt; 224.0.0.4: igmp
report 224.0.0.4<br>
7&nbsp;&nbsp; 11.70 (&nbsp; 3.20)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun &gt; 224.9.9.9: igmp
report 224.9.9.9<br>
<br>
8&nbsp; 125.51 (113.81)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun
&gt; 224.0.0.1: igmp query<br>
9&nbsp; 125.70 (&nbsp; 0.19)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun &gt; 224.9.9.9: igmp
report 224.9.9.9<br>
10&nbsp; 128.50 (&nbsp; 2.80)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun &gt; 224.1.2.3: igmp
report 224.1.2.3<br>
11&nbsp; 129.10 (&nbsp; 0.60)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun &gt; 224.0.0.4: igmp
report 224.0.0.4<br>
<br>
12&nbsp; 247.82 (118.72)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun
&gt; 224.0.0.1: igmp query<br>
13&nbsp; 248.09 (&nbsp; 0.27)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun &gt; 224.1.2.3: igmp
report 224.1.2.3<br>
14&nbsp; 248.69 (&nbsp; 0.60)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun &gt; 224.0.0.4: igmp
report 224.0.0.4<br>
15&nbsp; 255.29 (&nbsp; 6.60)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun &gt; 224.9.9.9: igmp
report 224.9.9.9<br>
</p>


<p>&nbsp;</p>

<p><small>Рисунок 13.5 Вывод команды tcpdump за время
работы демона маршрутизации.</small></p>

<p>&nbsp;</p>

<p><small>Мы не включили Ethernet адреса в этот вывод,
потому что уже убедились в том, что они именно
такие, какие должны быть. Также мы удалили весь
вывод, посвященный TTL равным 1, потому что они
также соответствуют ожидаемым. </small></p>

<p><small>В строке 1 показан момент старта демона
маршрутизации. Он отправляет отчет о том, что
вступил в группу 224.0.0.4. Групповой адрес 224.0.0.4 - это
заранее известный адрес и используется
протоколом групповой маршрутизации вектора
расстояний (<a NAME="t134010"></a>DVMRP - Distance Vector Multicast Routing
Protocol). Это протокол используется в настоящее
время для групповой маршрутизации. (DVMRP описан в
RFC 1075 <a NAME="t134011"></a>[Waitzman, Partridge, and Deering 1988].) </small></p>

<p><small>При старте демон посылает запрос (строка 2).
IP адрес назначения в запросе 224.0.0.1 (все хосты), как
показано на рисунке 13.3. </small></p>

<p><small>Первый отчет (строка 3) приходит примерно
через 5 секунд, для группы 224.9.9.9. Это единственный
отчет, принятый перед тем, как был отправлен
следующий запрос (строка 4). Два запроса (строки 2 и
4) отправляются с небольшим промежутком в момент
старта демона, так как он пытается построить
групповую таблицу маршрутизации. </small></p>

<p><small>В строках 5, 6 и 7 мы видим по одному отчету
для каждой группы, к которой принадлежит хост sun.
Обратите внимание, что принят отчет от группы
224.0.0.4, в дополнение к двум группам, в которые мы
вступили, потому что в то время пока работает
демон, он принадлежит к этой группе. </small></p>

<p><small>Следующий запрос в строке 8 появляется
через 2 минуты после предыдущего запроса. В ответ
на него также приходит три отчета (строки 9, 10 и 11).
В этот раз отчеты приходят в другом порядке, так
как время между приходом запроса и отправкой
отчета выбирается случайным образом. </small></p>

<p><small>И последний запрос, отправляется примерно
через 2 минуты после предыдущего запроса, и снова
получены ожидаемые отклики.</small></p>
<u><b>

<p><a NAME="t135000"></a>Краткие выводы</p>
</b></u>

<p><small>Групповая рассылка это способ разослать
сообщения нескольким получателям. Для многих
приложений это вариант предпочтительней, нежели
рассылка широковещательных запросов, так как с
помощью групповой рассылки можно уменьшить
загруженность хостов, которые не заинтересованы
в принятии сообщений. Простой протокол,
определяющий принадлежность хостов к группе (IGMP),
- это краеугольный камень, на котором строится
групповая адресация. </small></p>

<p><small>Групповая адресация в локальной сети или в
соседних, соединенных между собой локальных
сетях, использует технику, которую мы описали в
этой главе. Так как рассылка широковещательных
запросов обычно ограничивается одной локальной
сетью, групповые запросы могут быть использованы
вместо широковещательных для различных
предложений, которые в настоящее время
используют широковещательные запросы. </small></p>

<p><small>Однако, для глобальных сетей проблема
групповых запросов до сих пор до конца не решена. <a NAME="t135001"></a>[Deering and Cheriton 1990] предлагает расширение
существующих протоколов маршрутизации для
поддержки групповых запросов. В разделе 9.13 [<a NAME="t135002"></a>Perlman 1992] обсуждаются некоторые
проблемы, связанные с групповыми запросами в
глобальных сетях. </small></p>

<p><small><a NAME="t135003"></a>[Casner and Deering 1992] описывает
доставку звуковой информации для IETF конференций
по Internet с использованием групповых запросов и
виртуальной сети, которая называется MBONE
(групповая магистраль).</small></p>
<i><b>

<p>Упражнения</b></i> 

<ol>
  <li>Мы сказали, что хосты рассылают IGMP
    отчеты со случайными задержками. Как можно
    убедиться, что в локальной сети два хоста не
    генерируют отчет с одинаковой случайной
    задержкой?</li>
  <li>В [Casner and Deering 1992] сказано, что UDP не имеет двух
    характеристик, необходимых для посылки звуковой
    информации по MBONE: определение изменения порядка
    движения пакетов и определение дублированных
    пакетов. Как Вы можете добавить эти возможности в
    UDP?</li>
</ol>

<hr>

</body>
</html>
