<html>

<head>
<title>Программа sock</title>

<meta http-equiv="Content-type" content="text/html; charset=koi8-r">
<link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>


<b>

<p><a NAME="t330000"></a>Приложение C Программа sock</p>
</b>

<p><small>Для генерации TCP и UDP данных использовалась
простая тестовая программа, называемая <a NAME="t330001"></a>sock.
Она выполняла функции как клиента, так и сервера.
С помощью этой тестовой программы, которую можно
запустить из приглашения shellа, мы избежали
необходимости писать новые программы клиента и
сервера на языке программирования C для каждой
специальной характеристики, которую хотели
протестировать. Так как цель этой книги -
понимание сетевых протоколов, а не сетевого
программирования, в этом приложении мы
ограничимся описанием программы и ее опций.</small></p>

<p><small>&nbsp;</small></p>


<p>Существует
определенное количество программ, функционально
похожих на sock. <a NAME="t330002"></a>Juergen Nickelsen написал
программу, которая называется <a NAME="t330003"></a>socket, а <a NAME="t330004"></a>Dave Yost программу <a NAME="t330005"></a>sockio. Обе
реализуют много похожих функций. Части программы
sock также были получены из свободно
распространяемой программы <a NAME="t330006"></a>ttcp,
написанной <a NAME="t330007"></a>Mike Muuss и <a NAME="t330008"></a>Terry
Slattery. </p>


<p><small>&nbsp;</small></p>

<p><small>Программа sock может работать в одном из
четырех режимов:</small></p>

<p><small>&nbsp;</small>

<ol>
  <li><small>Интерактивный клиент: по умолчанию.
    Программа подсоединяется к серверу и затем
    копирует стандартный ввод на сервер и копирует
    все, что получено от сервера, на стандартный
    вывод. Это показано на рисунке С.1.<a NAME="t330009"></a></small><p ALIGN="CENTER"><small><img SRC="tC_10000.jpg" WIDTH="385" HEIGHT="48"></small></p>
    <p ALIGN="CENTER"><small>Рисунок С.1
    Функционирование программы sock как
    интерактивного клиента.</small></p>
    <p><small>&nbsp;</small></p>
    <p><small>Мы должны указать имя хоста сервера и имя
    сервиса, к которому необходимо подсоединиться.
    Хост может быть указан в виде IP адреса, а сервис
    может быть указан в виде целого номера порта.
    Подсоединение к стандартному эхо серверу (глава
    1, раздел <a HREF="tcp01.html#t01C000">&quot;Стандартные простые
    сервисы&quot;</a>), от sun к bsdi, отражает эхом все, что
    введено:</small></p>
    <pre>
sun % sock bsdi echo<b>
a test line </b>                   вводим строку
a test line                    эхо сервер вернул копию
^<b>D </b>                            вводим символ конца файла, чтобы прекратить работу программы
</pre>
  </li>
  
  <li><small>Интерактивный сервер: указана опция -s.
    Необходимо указать имя сервиса (или номер порта):</small><pre>
sun % <b>sock s 5555 </b>           работает как сервер, слушает порт 5555
</pre>
    <p><small>Программа ожидает соединения
    от клиента и затем копирует стандартный ввод
    клиенту и копирует все, что получено от клиента,
    на стандартный вывод. В командной строке перед
    номером порта может стоять Internet адрес, чтобы
    указать, с какого локального интерфейса будет
    принято соединение:</small></p>
    <pre>
sun % <b>sock -s 140.252.13.33 5555 </b>       принимает соединения только по Ethernet
</pre>
    <p><small>По умолчанию запрос на
    соединение принимается с любого локального
    интерфейса.</small></p>
  </li>
  <li><small>Клиент источник: указана опция -i. По
    умолчанию, буфер размером 1024 байта записывается
    в сеть 1024 раза. С помощью опций -n и -w можно
    изменить эти значения. Например, команда</small><pre>sun % <b>sock -i -n12 -w4096 bsdi discard </b>
</pre>
    <p><small>запишет 12 буферов, каждый из
    которых по 4096 байт, на discard сервис хоста bsdi.</small></p>
  </li>
  <li><small>Сервер приемник: указаны опции -i и -s. Данные
    читаются из сети и отбрасываются.</small></li>
</ol>

<p><small>&nbsp;</small></p>

<p><small>Несмотря на то, что в этих примерах
использовался TCP (по умолчанию), с помощью опции -u
можно использовать UDP. </small></p>

<p><small>Существует большое количество опций, что
позволяет полностью контролировать
функционирование программы. С помощью этих опций
можно реализовать практически все, что было
показано в тексте.<a NAME="t330010"></a></small></p>

<p><small>&nbsp;</small>

<dl>
  <p><small>-b n</small></p>
  <dd><small>Воспринимает n как номер локального порта
    клиента. (По умолчанию используется динамический
    номер порта, назначенный системой клиента.)</small></dd>
  <p><small><a NAME="t330011"></a>-c</small></p>
  <dd><small>Конвертирует символы новой строки, которые
    прочитаны из стандартного ввода, в символы
    возврата каретки и пропуска строки. Когда
    осуществляется чтение из сети, конвертирует
    последовательность &lt;возврат каретки, пропуск
    строки&gt; в единственный символ новой строки.
    Большинство Internet приложений работают с <a NAME="t330012"></a>NVT
    ASCII (глава 26, раздел <a HREF="tcp26.html#t264000">&quot;Протокол
    Telnet&quot;</a>), где возврат каретки и пропуск строки
    используются для завершения каждой строки.</small></dd>
  <p><small><a NAME="t330013"></a>-f a.b.c.d.p</small></p>
  <dd><small><a NAME="t330014"></a>Указывает удаленный IP адрес
    (a.b.c.d) и удаленный номер порта (p) для конечной
    точки UDP (глава 11, раздел <a HREF="tcp11.html#t11C000">&quot;Сервер
    UDP&quot;</a>).</small></dd>
  <p><small><a NAME="t330015"></a>-h</small></p>
  <dd><small>Переводит TCP соединение в <a NAME="t330016"></a>наполовину
    закрытое состояние (глава 18, раздел&nbsp;<a HREF="tcp18.html#t185000">&quot;Наполовину закрытый TCP&quot;</a>). То
    есть, соединение не разрывается при появлении в
    стандартном вводе символа конца файла. Вместо
    этого, соединение наполовину закрывается, при
    этом чтение из сети продолжается до тех пор, пока
    сам хост не закроет соединение.</small></dd>
  <p><small><a NAME="t330017"></a>-i</small></p>
  <dd><small>Клиент источник или сервер приемник. Либо
    пишет данные в сеть (по умолчанию), либо, если
    используется с опцией -s, читает данные из сети.
    Опция -n указывает количество буферов, которые
    необходимо записать (или считать), опция -w
    указывает размер каждой записи, а опция -r
    указывает размер каждого чтения.</small></dd>
  <p><small><a NAME="t330018"></a>-n n</small></p>
  <dd><small>Когда используется с опцией -i, n указывает
    количество буферов, которые необходимо считать
    или записать. По умолчанию n равно 1024.</small></dd>
  <p><small><a NAME="t330019"></a>-p n</small></p>
  <dd><small>Указывает количество секунд, в течение
    которых необходимо выдержать паузу, перед каждым
    чтением или записью. Это может быть использовано
    в случае клиента источника (-i) или сервера
    приемника (-is), чтобы вставить задержку между
    каждым чтением или записью в сеть. Также
    существует опция -P, которая позволяет вставить
    паузу перед первым чтением или записью.</small></dd>
  <p><small><a NAME="t330020"></a>-q n</small></p>
  <dd><small><a NAME="t330021"></a>Указывает размер очереди
    ожидания соединения для TCP сервера: разрешенное
    количество соединений, которое TCP может
    поставить в очередь для приложения (<a HREF="tcp18.html#t18B022">рисунок 18.23</a>). По умолчанию равно 5.</small></dd>
  <p><small><a NAME="t330022"></a>-r n</small></p>
  <dd><small>Когда используется с опциями -is, n определяет
    размер каждого чтения из сети. По умолчанию 1024
    байта за одно чтение.</small></dd>
  <p><small><a NAME="t330023"></a>-s</small></p>
  <dd><small>Функционирует как сервер, а не как клиент.</small></dd>
  <p><small><a NAME="t330024"></a>-u</small></p>
  <dd><small>Использует UDP вместо TCP.</small></dd>
  <p><small><a NAME="t330025"></a>-v</small></p>
  <dd><small>Отладочный режим. Печатает дополнительные
    подробности (как, например, динамически
    назначаемые номера портов клиента и сервера) в
    стандартный вывод ошибок.</small></dd>
  <p><small><a NAME="t330026"></a>-w n</small></p>
  <dd><small>Когда используется с опцией -i, определяет
    размер каждой записи в сеть. По умолчанию 1024
    байта за запись.</small></dd>
  <p><small><a NAME="t330027"></a>-A</small></p>
  <dd><small>Включает опцию сокета <a NAME="t330028"></a>SO_REUSEADDR. В
    случае TCP это позволяет процессу назначить
    самому себе номер порта, который является частью
    соединения, находящегося в состоянии ожидания <a NAME="t330029"></a>2MSL. В случае UDP, если система
    поддерживает групповую адресацию, это позволяет
    нескольким процессам использовать один и тот же
    локальный порт для получения широковещательных
    или групповых датаграмм.</small></dd>
  <p><small><a NAME="t330030"></a>-B</small></p>
  <dd><small><a NAME="t330031"></a>Включает опцию сокета <a NAME="t330032"></a>SO_BROADCAST,
    что позволяет UDP датаграммам быть отправленным
    на широковещательный IP адрес.</small></dd>
  <p><small><a NAME="t330033"></a>-D</small></p>
  <dd><small><a NAME="t330034"></a>Включает опцию сокета <a NAME="t330035"></a>SO_DEBUG.
    При этом выводится дополнительная отладочная
    информация, которую содержит ядро для этого TCP
    соединения (приложение A, раздел <a HREF="tcp_a.html#t316000">&quot;Опция
    отладки сокета&quot;</a>). Эта информация может быть
    получена позже, с помощью запуска программы <a NAME="t330036"></a>trpt(8).</small></dd>
  <p><small><a NAME="t330037"></a>-E</small></p>
  <dd><small>Включает опцию сокета <a NAME="t330038"></a>IP_RECVDSTADDR,
    если она поддерживается реализацией (глава 11,
    раздел <a HREF="tcp11.html#t11C000">&quot;Сервер UDP&quot;</a>). <a NAME="t330039"></a>Это предназначено для UDP серверов,
    чтобы печатать IP адреса назначения полученных UDP
    датаграмм.</small></dd>
  <p><small><a NAME="t330040"></a>-F</small></p>
  <dd><small>Будет использоваться <a NAME="t330041"></a>конкурентный
    TCP сервер. В этом случае сервер создает новый
    процесс с использованием программы <a NAME="t330042"></a>fork
    для каждого соединения клиента.</small></dd>
  <p><small><a NAME="t330043"></a>-K</small></p>
  <dd><small><a NAME="t330044"></a>Включает опцию TCP сокета <a NAME="t330045"></a>SO_KEEPALIVE (<a HREF="tcp23.html">глава 23</a>).</small></dd>
  <p><small><a NAME="t330046"></a>-L n</small></p>
  <dd><small><a NAME="t330047"></a>Устанавливает время задержки
    (опция сокета <a NAME="t330048"></a>SO_LINGER) для конечной
    точки TCP в значение n. Время задержки равное 0
    означает, что когда соединение закрывается,
    любые данные, оставшиеся в очереди для отправки,
    отбрасываются, а удаленному хосту посылается
    сброс (глава 18, раздел&nbsp;<a HREF="tcp18.html#t187000">&quot;Сегменты
    сброса (Reset)&quot;</a>). Положительное время задержки -
    это время (в сотых долях секунды), в течение
    которого соединение не закрывается, пока все
    данные не будут отправлены и подтверждены. Если,
    после закрытия сетевого соединения, не все
    данные были отправлены и подтверждены в момент
    истечения этого таймера, закрытие вернет
    ошибочный код возврата.</small></dd>
  <p><small><a NAME="t330049"></a>-N</small></p>
  <dd><small><a NAME="t330050"></a>Устанавливает опцию сокета <a NAME="t330051"></a>TCP_NODELAY, чтобы выключить алгоритм <a NAME="t330052"></a>Нагла (глава 19, раздел <a HREF="tcp19.html#t194000">&quot;Алгоритм
    Нагла&quot;</a>).</small></dd>
  <p><small><a NAME="t330053"></a>-O n</small></p>
  <dd><small>Сообщает TCP серверу количество секунд, в
    течение которых тот должен выдержать паузу,
    перед приемом первого соединения от клиента.</small></dd>
  <p><small><a NAME="t330054"></a>-P n</small></p>
  <dd><small>Указывает количество секунд, в течение
    которых необходимо выдержать паузу, перед тем
    как будет осуществлено первое чтение или запись
    в сеть. Это может быть использовано с сервером
    приемником (-is), чтобы осуществить задержку после
    приема запроса на соединение от клиента, однако
    перед тем, как осуществить первое чтение из сети.
    При использовании с клиентом источником или
    сервером приемником (-i), эта величина определяет
    промежуток времени между установлением
    соединения и перед первой записью в сеть. Опция -p
    определяет паузу между каждыми соседними
    чтениями или записями.</small></dd>
  <p><small><a NAME="t330055"></a>-Q n</small></p>
  <dd><small>Указывает количество секунд для TCP клиента
    или сервера, в течение которых необходимо
    выдержать паузу, после получения символа конца
    файла с удаленного конца, перед тем как закрыть
    соединение со своей стороны.</small></dd>
  <p><small><a NAME="t330056"></a>-R n</small></p>
  <dd><small>Устанавливает <a NAME="t330057"></a>приемный буфер
    сокета (опция сокета <a NAME="t330058"></a>SO_RCVBUF) в значение
    n. Это может непосредственно повлиять на размер
    приемного окна, объявляемого TCP. В случае UDP
    определяет максимальный размер UDP датаграммы,
    которая может быть принята.</small></dd>
  <p><small><a NAME="t330059"></a>-S n</small></p>
  <dd><small>Устанавливает <a NAME="t330060"></a>отправляющий
    буфер сокета (опция сокета <a NAME="t330061"></a>SO_SNDBUF) в
    значение n. В случае UDP определяет максимальный
    размер UDP датаграммы, которая может быть
    отправлена.</small></dd>
  <p><small><a NAME="t330062"></a>-U n</small></p>
  <dd><small>Переводит TCP в <a NAME="t330063"></a>режим срочности
    после осуществления записи номер n в сеть. Для
    входа в режим срочности записывается один байт
    данных (глава 20, раздел&nbsp;<a HREF="tcp20.html#t208000">&quot;Режим
    срочности (Urgent Mode)&quot;</a>).</small></dd>
</dl>

<hr>

</body>
</html>
